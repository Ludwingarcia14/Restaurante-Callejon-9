<!DOCTYPE html>
<html lang="es">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta charset="UTF-8">
    
    <title>Cliente - {% block title %}Dashboard{% endblock %}</title>

    <meta name="csrf-token" content="{{ session.get('_csrf_token') }}">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="{{ url_for('static', filename='js/socket.io.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/notificaciones.js') }}"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
    <link rel="shortcut icon" href="{{ url_for('static', filename='img/icon.png') }}" type="image/x-icon">

    </head>
<style>
  /* --- Paleta personalizada --- */
  :root {
    --color-fondo: #f4f6fb;
    --color-primario: #5b7fff;
    --color-secundario: #8b9eff;
    --color-texto: #333;
    --color-card: #ffffff;
    --color-hover: #eef1ff;
    --sombra-card: 0 6px 15px rgba(91, 127, 255, 0.15);
    --sombra-flotante: 0 10px 25px rgba(91, 127, 255, 0.3);
  }

  body {
    background: var(--color-fondo);
    font-family: 'Inter', sans-serif;
  }

  /* --- Animaciones --- */
  .fade-in { animation: fadeIn 0.6s ease-in-out; }
  .fade-up { animation: fadeUp 0.6s ease-out forwards; opacity: 0; transform: translateY(20px); }
  .delay-1 { animation-delay: 0.1s; }
  .delay-2 { animation-delay: 0.2s; }
  .delay-3 { animation-delay: 0.3s; }

  @keyframes fadeIn {
    from { opacity: 0; } to { opacity: 1; }
  }
  @keyframes fadeUp {
    to { opacity: 1; transform: translateY(0); }
  }

  /* --- Tarjetas --- */
  .dashboard-card {
    background: var(--color-card);
    border-radius: 1rem;
    box-shadow: var(--sombra-card);
    padding: 1.5rem; /* Ajustado para mejor fit */
    transition: all 0.3s ease;
    border: 2px solid transparent;
    position: relative;
    overflow: hidden;
  }

  .dashboard-card:hover {
    transform: translateY(-5px);
    background: var(--color-hover);
    border-color: var(--color-secundario);
  }

  /* Iconos y Textos */
  .icon-box {
    color: var(--color-primario);
    transition: transform 0.3s;
  }
  .dashboard-card:hover .icon-box {
    transform: scale(1.1);
  }

  .gradient-text {
    background: linear-gradient(90deg, var(--color-primario), var(--color-secundario));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    font-weight: 700;
  }

  /* --- Elementos Espec√≠ficos --- */
  /* Widget de Saldo */
  .progress-bar-bg {
    background-color: #e0e7ff;
    border-radius: 999px;
    height: 10px;
    width: 100%;
    margin-top: 10px;
  }
  .progress-bar-fill {
    background: linear-gradient(90deg, var(--color-primario), var(--color-secundario));
    height: 100%;
    border-radius: 999px;
    width: 0%; /* Se anima con JS o inline style */
    transition: width 1s ease-out;
  }

  /* Bot√≥n Flotante */
  .floating-btn {
    position: fixed;
    bottom: 2rem;
    right: 2rem;
    background: var(--color-card);
    padding: 10px 20px;
    border-radius: 50px;
    box-shadow: var(--sombra-flotante);
    display: flex;
    align-items: center;
    gap: 10px;
    text-decoration: none;
    z-index: 100;
    transition: transform 0.3s ease;
    border: 1px solid #e0e7ff;
  }
  .floating-btn:hover {
    transform: scale(1.05);
  }
  .floating-icon {
    background: var(--color-primario);
    color: white;
    width: 35px;
    height: 35px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  /* Responsive */
  @media (max-width: 768px) {
    .dashboard-card { padding: 1.25rem; }
    .col-span-2-md { grid-column: span 1 !important; } /* En m√≥vil el widget grande ocupa 1 */
  }
</style>
<body class="bg-gradient-to-br from-gray-50 to-gray-200 text-gray-800 font-sans flex min-h-screen">

    <aside class="w-64 bg-white border-r border-gray-200 shadow-lg flex flex-col 
             sticky top-0 h-screen overflow-hidden">
        <div class="h-20 flex items-center justify-center">
            <img src="{{ url_for('static', filename='img/Logo2.png') }}" alt="Logo" class="w-29">
        </div>

        <div class="px-6 py-4 border-b border-gray-200 text-center">
            {% if session['usuario_foto'] %}
                <img src="{{ url_for('static', filename='images/perfiles/' ~ session['usuario_foto']) }}" alt="Foto de Perfil" class="w-16 h-16 rounded-full mx-auto mb-2 shadow-md">
            {% else %}
                <img src="{{ url_for('static', filename='images/perfiles/default.png') }}" alt="Foto de Perfil por Defecto" class="w-16 h-16 rounded-full mx-auto mb-2 shadow-md">
            {% endif %}
            <p class="font-medium">
                {{ session['usuario_nombre'] }} {{ session.get('usuario_apellidos', '') }}
            </p>
            <p class="text-sm text-gray-500">{{ session['usuario_email'] }}</p>
        </div>

        <nav class="px-4 py-6 space-y-2 text-sm overflow-y-auto">
            <a href="{{ url_for('routes.dashboard_client') }}"
               class="block px-4 py-2 rounded-lg hover:bg-gray-100 font-semibold transition">
               <i class="bi bi-house-door me-2"></i> Inicio
            </a>
            
            <a href="{{ url_for('routes.perfil_cliente') }}"
               class="block px-4 py-2 rounded-lg hover:bg-gray-100 transition">
               <i class="bi bi-person-circle me-2"></i> Perfil
            </a>
            
            <a href="{{ url_for('routes.asesor_asignado') }}"
               class="block px-4 py-2 rounded-lg hover:bg-gray-100 transition">
               <i class="bi bi-person-badge me-2"></i> Asesor
            </a>
            
            <a href="{{ url_for('routes.documentos_view') }}"
               class="block px-4 py-2 rounded-lg hover:bg-gray-100 transition">
               <i class="bi bi-folder2-open me-2"></i> Documentos
            </a>

            <div>
                <button onclick="toggleMenu('creditoSubmenu')"
                        class="w-full text-left px-4 py-2 rounded-lg hover:bg-gray-100 flex justify-between items-center">
                    <span><i class="bi bi-cash-stack me-2"></i> Mi Cr√©dito</span>
                    <span id="icon-credito">‚ñº</span>
                </button>
                <div id="creditoSubmenu" class="ml-4 mt-1 space-y-1 hidden">
                    <a href="{{ url_for('routes.credito_view') }}"
                       class="block px-4 py-2 rounded-lg hover:bg-gray-100 text-sm">
                       <i class="bi bi-graph-up-arrow me-2"></i> Resumen
                    </a>
                    <a href="{{ url_for('routes.historial_credito') }}"
                       class="block px-4 py-2 rounded-lg hover:bg-gray-100 text-sm">
                       <i class="bi bi-journal-text me-2"></i> Historial
                    </a>
                    <button data-modal="modal-pagos"
                            class="open-modal block w-full text-left px-4 py-2 rounded-lg hover:bg-gray-100 text-sm">
                       <i class="bi bi-credit-card me-2"></i> Pagos
                    </button>
                </div>
            </div>

            <div>
                <button onclick="toggleMenu('soporteSubmenu')"
                        class="w-full text-left px-4 py-2 rounded-lg hover:bg-gray-100 flex justify-between items-center">
                    <span><i class="bi bi-headset me-2"></i> Soporte</span>
                    <span id="icon-soporte">‚ñº</span>
                </button>
                <div id="soporteSubmenu" class="ml-4 mt-1 space-y-1 hidden">
                    <a href="{{ url_for('routes.soporte') }}"
                       class="open-modal block px-4 py-2 rounded-lg hover:bg-gray-100 text-sm">
                       <i class="bi bi-chat-dots me-2"></i> Chat de Soporte
                    </a>
                    <button data-modal="modal-tickets"
                            class="open-modal block w-full text-left px-4 py-2 rounded-lg hover:bg-gray-100 text-sm">
                       <i class="bi bi-ticket-detailed me-2"></i> Mis Tickets
                    </button>
                </div>
            </div>
            
        </nav>

        <div class="p-4 mt-auto text-center">
            <a href="{{ url_for('routes.logout') }}"
               class="inline-block bg-red-100 text-red-500 px-4 py-2 rounded-full hover:bg-red-200 hover:text-red-600 text-sm shadow-sm">
                <i class="bi bi-door-open"></i> Cerrar sesi√≥n
            </a>
        </div>
    </aside>

    <main class="flex-1 p-10 overflow-y-auto">
        
        <div class="flex justify-between items-center mb-8">
            <h1 class="text-3xl font-bold text-gray-800">{{ self.title() }}</h1>
            
            <div class="flex items-center space-x-6 bg-white px-6 py-3 rounded-full shadow-sm border border-gray-200">
                <div class="text-right">
                    <p class="text-xs font-semibold text-gray-500">Estado actual:</p>
                    <p class="text-md font-bold text-blue-600">{{ estado_credito or "Activo" }}</p>
                </div>
                
                <div class="border-l h-10 border-gray-200"></div>

                <div class="flex items-center space-x-3">
                    {% if session['usuario_foto'] %}
                        <img src="{{ url_for('static', filename='images/perfiles/' ~ session['usuario_foto']) }}" alt="Foto de Perfil" class="w-9 h-9 rounded-full border-2 border-gray-200">
                    {% else %}
                        <img src="{{ url_for('static', filename='images/perfiles/default.png') }}" alt="Foto de Perfil por Defecto" class="w-9 h-9 rounded-full border-2 border-gray-200">
                    {% endif %}
                </div>

                <div class="border-l h-10 border-gray-200"></div>

                <div class="relative">
                    <button id="btnNotificaciones" class="relative text-gray-500 hover:text-blue-600 text-2xl focus:outline-none">
                        <i class="bi bi-bell-fill"></i>

                        <span id="contador-notificaciones"
                            class="hidden absolute -top-2 -right-2 bg-red-600 text-white text-xs rounded-full px-1.5 py-0.5 border-2 border-white">
                            0
                        </span>
                    </button>

                    <div id="listaNotificaciones"
                        class="hidden absolute right-0 mt-3 w-80 bg-white text-gray-700 border border-gray-200 rounded-lg shadow-xl overflow-hidden z-50">

                        <div class="px-4 py-2 bg-gray-50 font-semibold border-b text-gray-800 flex justify-between items-center">
                            <span>Notificaciones</span>
                            <button onclick="limpiarContador()" class="text-xs text-blue-500 hover:underline">Marcar le√≠das</button>
                        </div>

                        <ul id="lista-items-notificaciones" class="max-h-60 overflow-y-auto">
                            <li id="sin-notificaciones" class="px-4 py-3 text-gray-400 text-sm text-center">
                                No hay notificaciones nuevas.
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        {% block content %}{% endblock %}
    </main>
    <a href="#" class="floating-btn fade-in">
        <div class="floating-icon">
            <i class="bi bi-chat-dots-fill"></i>
        </div>
        <span class="text-sm font-semibold text-gray-600">Ayuda</span>
    </a>
    <script>
        // Script para men√∫s colapsables (del layout de admin)
        function toggleMenu(id) {
            const submenu = document.getElementById(id);
            submenu.classList.toggle('hidden');
            const iconId = 'icon-' + id.replace('Submenu', '').toLowerCase();
            const icon = document.getElementById(iconId);
            if (icon) icon.textContent = submenu.classList.contains('hidden') ? '‚ñº' : '‚ñ≤';
        }

        // Script para dropdown de notificaciones (del layout de cliente)
        const btnNotif = document.getElementById("btnNotificaciones");
        const listaNotif = document.getElementById("listaNotificaciones");

        if (btnNotif) {
            btnNotif.addEventListener("click", () => {
                listaNotif.classList.toggle("hidden");
            });
        }

        window.addEventListener("click", (e) => {
            if (btnNotif && !btnNotif.contains(e.target) && !listaNotif.contains(e.target)) {
                listaNotif.classList.add("hidden");
            }
        });
    </script>
    <script>
document.addEventListener("DOMContentLoaded", () => {
    const btn = document.getElementById("btnNotificaciones");
    const menu = document.getElementById("listaNotificaciones");

    // üëâ Alternar men√∫
    btn.addEventListener("click", (e) => {
        e.stopPropagation(); // evita que cierre inmediatamente
        menu.classList.toggle("hidden");
    });

    // üëâ Cerrar al hacer clic afuera
    document.addEventListener("click", (e) => {
        if (!menu.contains(e.target) && !btn.contains(e.target)) {
            menu.classList.add("hidden");
        }
    });
});

// üëâ Limpiar contador
function limpiarContador() {
    const contador = document.getElementById("contador-notificaciones");
    contador.textContent = "0";
    contador.classList.add("hidden");
}
</script>

</body>
</html>