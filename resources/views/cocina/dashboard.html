{% extends "layout/layout_base.html" %}

{% block title %}Panel de Cocina{% endblock %}
{% block page_title %}Dashboard de Cocina{% endblock %}
{% block page_subtitle %}Gesti√≥n de pedidos y preparaci√≥n{% endblock %}

{% block navigation %}
<a href="{{ url_for('routes.dashboard_cocina') }}" class="nav-link active">
    <i class="bi bi-house-door"></i>
    <span>Inicio</span>
</a>

<a href="{{ url_for('routes.cocina_pedidos') }}" class="nav-link">
    <i class="bi bi-list-task"></i>
    <span>Pedidos Pendientes</span>
</a>

<a href="{{ url_for('routes.cocina_en_proceso') }}" class="nav-link">
    <i class="bi bi-hourglass-split"></i>
    <span>En Preparaci√≥n</span>
</a>

<a href="{{ url_for('routes.cocina_listos') }}" class="nav-link">
    <i class="bi bi-check-circle"></i>
    <span>Listos</span>
</a>

<a href="{{ url_for('routes.cocina_inventario') }}" class="nav-link">
    <i class="bi bi-box-seam"></i>
    <span>Inventario</span>
</a>
{% endblock %}

{% block content %}

<!-- ===================================
     HEADER CON INFO DE COCINA
     =================================== -->
<div class="bg-gradient-to-r from-orange-500 to-red-600 p-6 rounded-xl shadow-lg text-white mb-6">
    <div class="flex items-center justify-between">
        <div>
            <h2 class="text-2xl font-bold mb-2">¬°Bienvenido, {{ session.usuario_nombre }}! üî•</h2>
            <div class="flex items-center gap-4 text-sm opacity-90">
                <div class="flex items-center gap-2">
                    <i class="bi bi-egg-fried"></i>
                    <span>√Årea: {{ perfil.area|title if perfil.area else 'General' }}</span>
                </div>
                <div class="flex items-center gap-2">
                    <i class="bi bi-clock"></i>
                    <span>Turno: {{ perfil.turno|title if perfil.turno else 'N/A' }}</span>
                </div>
                <div class="flex items-center gap-2">
                    <i class="bi bi-person-badge"></i>
                    <span>{{ perfil.puesto|title if perfil.puesto else 'Cocinero' }}</span>
                </div>
            </div>
        </div>
        <div class="text-right">
            <div class="text-4xl font-bold" id="pedidos-pendientes-count">0</div>
            <div class="text-sm opacity-90">Pedidos Pendientes</div>
        </div>
    </div>
</div>

<!-- ===================================
     ESTAD√çSTICAS DE COCINA
     =================================== -->
<div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
    
    <!-- Pedidos Nuevos -->
    <div class="bg-white p-6 rounded-xl shadow-md border-l-4 border-red-500 hover:shadow-lg transition">
        <div class="flex items-center justify-between mb-2">
            <i class="bi bi-bell-fill text-4xl text-red-500 animate-pulse"></i>
            <span class="text-3xl font-bold text-gray-800" id="stat-nuevos">0</span>
        </div>
        <p class="text-sm text-gray-600 font-medium">Pedidos Nuevos</p>
        <p class="text-xs text-red-600 mt-1">
            <i class="bi bi-exclamation-circle"></i> Requieren atenci√≥n
        </p>
    </div>

    <!-- En Preparaci√≥n -->
    <div class="bg-white p-6 rounded-xl shadow-md border-l-4 border-orange-500 hover:shadow-lg transition">
        <div class="flex items-center justify-between mb-2">
            <i class="bi bi-fire text-4xl text-orange-500"></i>
            <span class="text-3xl font-bold text-gray-800" id="stat-preparacion">0</span>
        </div>
        <p class="text-sm text-gray-600 font-medium">En Preparaci√≥n</p>
        <p class="text-xs text-orange-600 mt-1">
            <i class="bi bi-clock"></i> En proceso
        </p>
    </div>

    <!-- Listos -->
    <div class="bg-white p-6 rounded-xl shadow-md border-l-4 border-green-500 hover:shadow-lg transition">
        <div class="flex items-center justify-between mb-2">
            <i class="bi bi-check-circle-fill text-4xl text-green-500"></i>
            <span class="text-3xl font-bold text-gray-800" id="stat-listos">0</span>
        </div>
        <p class="text-sm text-gray-600 font-medium">Listos</p>
        <p class="text-xs text-green-600 mt-1">
            <i class="bi bi-bell"></i> Para servir
        </p>
    </div>

    <!-- Completados Hoy -->
    <div class="bg-white p-6 rounded-xl shadow-md border-l-4 border-purple-500 hover:shadow-lg transition">
        <div class="flex items-center justify-between mb-2">
            <i class="bi bi-graph-up text-4xl text-purple-500"></i>
            <span class="text-3xl font-bold text-gray-800" id="stat-completados">0</span>
        </div>
        <p class="text-sm text-gray-600 font-medium">Completados Hoy</p>
        <p class="text-xs text-purple-600 mt-1">
            <i class="bi bi-trophy"></i> Tiempo promedio: <span id="tiempo-promedio">--</span> min
        </p>
    </div>
    
</div>

<!-- ===================================
     ESPECIALIDADES Y √ÅREA
     =================================== -->
{% if perfil.especialidad %}
<div class="card mb-6">
    <div class="card-header">
        <h2 class="card-title">
            <i class="bi bi-star-fill text-yellow-500"></i>
            Mis Especialidades
        </h2>
    </div>
    <div class="card-body">
        <div class="flex flex-wrap gap-2">
            {% for esp in perfil.especialidad %}
            <span class="px-4 py-2 bg-gradient-to-r from-orange-100 to-red-100 text-orange-800 rounded-full font-semibold text-sm shadow-sm">
                <i class="bi bi-award"></i> {{ esp|title }}
            </span>
            {% endfor %}
        </div>
    </div>
</div>
{% endif %}

<!-- ===================================
     TABLERO DE PEDIDOS (KANBAN)
     =================================== -->
<div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
    
    <!-- COLUMNA: PENDIENTES -->
    <div class="bg-white rounded-xl shadow-md overflow-hidden">
        <div class="bg-gradient-to-r from-red-500 to-red-600 text-white p-4 flex items-center justify-between">
            <div class="flex items-center gap-2">
                <i class="bi bi-bell-fill text-xl"></i>
                <h3 class="font-bold">Pendientes</h3>
            </div>
            <span class="px-3 py-1 bg-white bg-opacity-20 rounded-full text-sm font-bold" id="count-pendientes">0</span>
        </div>
        <div class="p-4 space-y-3 max-h-[600px] overflow-y-auto" id="columna-pendientes">
            <!-- Los pedidos se cargan aqu√≠ din√°micamente -->
            <div class="text-center py-12 text-gray-400">
                <i class="bi bi-inbox text-5xl mb-3 block"></i>
                <p class="text-sm">Sin pedidos pendientes</p>
            </div>
        </div>
    </div>

    <!-- COLUMNA: EN PREPARACI√ìN -->
    <div class="bg-white rounded-xl shadow-md overflow-hidden">
        <div class="bg-gradient-to-r from-orange-500 to-orange-600 text-white p-4 flex items-center justify-between">
            <div class="flex items-center gap-2">
                <i class="bi bi-fire text-xl"></i>
                <h3 class="font-bold">En Preparaci√≥n</h3>
            </div>
            <span class="px-3 py-1 bg-white bg-opacity-20 rounded-full text-sm font-bold" id="count-preparacion">0</span>
        </div>
        <div class="p-4 space-y-3 max-h-[600px] overflow-y-auto" id="columna-preparacion">
            <div class="text-center py-12 text-gray-400">
                <i class="bi bi-hourglass-split text-5xl mb-3 block"></i>
                <p class="text-sm">Sin pedidos en preparaci√≥n</p>
            </div>
        </div>
    </div>

    <!-- COLUMNA: LISTOS -->
    <div class="bg-white rounded-xl shadow-md overflow-hidden">
        <div class="bg-gradient-to-r from-green-500 to-green-600 text-white p-4 flex items-center justify-between">
            <div class="flex items-center gap-2">
                <i class="bi bi-check-circle-fill text-xl"></i>
                <h3 class="font-bold">Listos</h3>
            </div>
            <span class="px-3 py-1 bg-white bg-opacity-20 rounded-full text-sm font-bold" id="count-listos">0</span>
        </div>
        <div class="p-4 space-y-3 max-h-[600px] overflow-y-auto" id="columna-listos">
            <div class="text-center py-12 text-gray-400">
                <i class="bi bi-check-circle text-5xl mb-3 block"></i>
                <p class="text-sm">Sin pedidos listos</p>
            </div>
        </div>
    </div>
    
</div>

<!-- ===================================
     ACCIONES R√ÅPIDAS
     =================================== -->
<div class="grid grid-cols-1 md:grid-cols-3 gap-4">
    
    <button onclick="marcarNoDisponible()" class="p-4 bg-white border-2 border-yellow-200 text-yellow-700 rounded-xl hover:bg-yellow-50 hover:border-yellow-400 transition flex items-center justify-between group">
        <div class="flex items-center gap-3">
            <div class="w-12 h-12 bg-yellow-100 rounded-lg flex items-center justify-center">
                <i class="bi bi-slash-circle text-2xl"></i>
            </div>
            <span class="font-semibold">Marcar Platillo No Disponible</span>
        </div>
        <i class="bi bi-arrow-right group-hover:translate-x-1 transition"></i>
    </button>

    <button onclick="verInventario()" class="p-4 bg-white border-2 border-blue-200 text-blue-700 rounded-xl hover:bg-blue-50 hover:border-blue-400 transition flex items-center justify-between group">
        <div class="flex items-center gap-3">
            <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center">
                <i class="bi bi-box-seam text-2xl"></i>
            </div>
            <span class="font-semibold">Consultar Inventario</span>
        </div>
        <i class="bi bi-arrow-right group-hover:translate-x-1 transition"></i>
    </button>

    <button onclick="actualizarPedidos()" class="p-4 bg-gradient-to-r from-purple-500 to-purple-600 text-white rounded-xl hover:shadow-lg transition flex items-center justify-between group">
        <div class="flex items-center gap-3">
            <div class="w-12 h-12 bg-white bg-opacity-20 rounded-lg flex items-center justify-center">
                <i class="bi bi-arrow-clockwise text-2xl"></i>
            </div>
            <span class="font-semibold">Actualizar Pedidos</span>
        </div>
        <i class="bi bi-arrow-right group-hover:translate-x-1 transition"></i>
    </button>
    
</div>

{% endblock %}

{% block extra_js %}
<!-- Socket.IO -->
<script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>

<script>
// ===================================
// VARIABLES GLOBALES
// ===================================
let pedidosData = {
    pendientes: [],
    preparacion: [],
    listos: []
};

let socket = null;
let audioNotificacion = null;

// ===================================
// INICIALIZACI√ìN
// ===================================
document.addEventListener('DOMContentLoaded', function() {
    console.log('üî• Dashboard Cocina inicializado');
    
    // Inicializar Socket.IO
    inicializarSocket();
    
    // Cargar pedidos iniciales
    cargarTodosPedidos();
    
    // Cargar estad√≠sticas
    cargarEstadisticas();
    
    // Actualizar cada 30 segundos (respaldo, Socket.IO es la fuente principal)
    setInterval(() => {
        cargarTodosPedidos();
        cargarEstadisticas();
    }, 30000);
    
    // Preparar sonido de notificaci√≥n
    audioNotificacion = new Audio('/static/sounds/notification.mp3');
});

// ===================================
// SOCKET.IO - NOTIFICACIONES EN TIEMPO REAL
// ===================================
async function inicializarSocket() {
    try {
        // Obtener token de autenticaci√≥n
        const response = await fetch('/api/me');
        const data = await response.json();
        
        if (!data.success) {
            console.error('‚ùå Error al obtener datos de usuario');
            return;
        }
        
        console.log('‚úÖ Datos de usuario obtenidos');
        
        // Conectar a Socket.IO
        socket = io({
            auth: {
                token: data.socket_token
            }
        });
        
        // Eventos de conexi√≥n
        socket.on('connect', () => {
            console.log('‚úÖ Socket.IO conectado');
            // Unirse a la sala de cocina
            socket.emit('join_room', 'cocina');
            console.log('üì• Unido a sala "cocina"');
        });
        
        socket.on('disconnect', () => {
            console.log('‚ùå Socket.IO desconectado');
        });
        
        socket.on('connect_error', (error) => {
            console.error('‚ùå Error de conexi√≥n Socket.IO:', error);
        });
        
        // Evento: NUEVO PEDIDO
        socket.on('nuevo_pedido', (data) => {
            console.log('üîî NUEVO PEDIDO RECIBIDO:', data);
            
            // Reproducir sonido
            reproducirSonido();
            
            // Mostrar notificaci√≥n
            mostrarNotificacionNuevoPedido(data);
            
            // Recargar pedidos
            cargarTodosPedidos();
            cargarEstadisticas();
        });
        
        // Evento: PEDIDO ACTUALIZADO
        socket.on('preparacion_iniciada', (data) => {
            console.log('üîÑ Pedido actualizado:', data);
            cargarTodosPedidos();
        });
        
        // Evento: PEDIDO LISTO (respuesta a cocina)
        socket.on('pedido_listo_confirmado', (data) => {
            console.log('‚úÖ Pedido listo confirmado:', data);
            cargarTodosPedidos();
        });
        
    } catch (error) {
        console.error('‚ùå Error al inicializar Socket.IO:', error);
    }
}

function mostrarNotificacionNuevoPedido(data) {
    // Notificaci√≥n visual con SweetAlert2
    Swal.fire({
        icon: 'info',
        title: 'üîî ¬°Nuevo Pedido!',
        html: `
            <div class="text-left">
                <p class="font-bold text-lg mb-2">Mesa ${data.mesa}</p>
                <p class="text-sm text-gray-600 mb-2">Mesero: ${data.mesero || 'N/A'}</p>
                <div class="bg-gray-100 p-3 rounded">
                    <p class="font-semibold text-sm mb-2">${data.num_items} platillo(s):</p>
                    <ul class="text-sm space-y-1">
                        ${data.items.map(item => `
                            <li>‚Ä¢ <strong>${item.cantidad}x</strong> ${item.nombre}</li>
                        `).join('')}
                    </ul>
                </div>
            </div>
        `,
        showConfirmButton: true,
        confirmButtonText: 'Ver Pedidos',
        timer: 5000,
        toast: false,
        position: 'center'
    });
}

function reproducirSonido() {
    try {
        if (audioNotificacion) {
            audioNotificacion.play().catch(e => {
                console.log('No se pudo reproducir sonido:', e);
            });
        }
    } catch (error) {
        console.log('Error al reproducir sonido:', error);
    }
}

// ===================================
// CARGA Y GESTI√ìN DE PEDIDOS
// ===================================
async function cargarTodosPedidos() {
    try {
        // Cargar pedidos pendientes, en proceso y listos en paralelo
        const [pendientes, enProceso, listos] = await Promise.all([
            fetch('/api/cocina/pedidos/pendientes').then(r => r.json()),
            fetch('/api/cocina/pedidos/en-proceso').then(r => r.json()),
            fetch('/api/cocina/pedidos/listos').then(r => r.json())
        ]);
        
        if (pendientes.success) {
            pedidosData.pendientes = pendientes.pedidos || [];
        }
        
        if (enProceso.success) {
            pedidosData.preparacion = enProceso.pedidos || [];
        }
        
        if (listos.success) {
            pedidosData.listos = listos.pedidos || [];
        }
        
        renderizarPedidos();
        
    } catch (error) {
        console.error('‚ùå Error al cargar pedidos:', error);
    }
}

async function cargarEstadisticas() {
    try {
        const response = await fetch('/api/cocina/estadisticas');
        const data = await response.json();
        
        if (data.success) {
            const stats = data.estadisticas;
            
            // Actualizar estad√≠sticas
            document.getElementById('stat-completados').textContent = stats.entregados || 0;
            
            // Si tienes tiempo promedio en las stats, actual√≠zalo
            // document.getElementById('tiempo-promedio').textContent = stats.tiempo_promedio || '--';
        }
    } catch (error) {
        console.error('‚ùå Error al cargar estad√≠sticas:', error);
    }
}

function renderizarPedidos() {
    // Renderizar pendientes
    const colPendientes = document.getElementById('columna-pendientes');
    if (pedidosData.pendientes.length === 0) {
        colPendientes.innerHTML = `
            <div class="text-center py-12 text-gray-400">
                <i class="bi bi-inbox text-5xl mb-3 block"></i>
                <p class="text-sm">Sin pedidos pendientes</p>
            </div>
        `;
    } else {
        colPendientes.innerHTML = pedidosData.pendientes.map(pedido => crearTarjetaPedido(pedido, 'pendiente')).join('');
    }
    
    // Renderizar en preparaci√≥n
    const colPreparacion = document.getElementById('columna-preparacion');
    if (pedidosData.preparacion.length === 0) {
        colPreparacion.innerHTML = `
            <div class="text-center py-12 text-gray-400">
                <i class="bi bi-hourglass-split text-5xl mb-3 block"></i>
                <p class="text-sm">Sin pedidos en preparaci√≥n</p>
            </div>
        `;
    } else {
        colPreparacion.innerHTML = pedidosData.preparacion.map(pedido => crearTarjetaPedido(pedido, 'preparacion')).join('');
    }
    
    // Renderizar listos
    const colListos = document.getElementById('columna-listos');
    if (pedidosData.listos.length === 0) {
        colListos.innerHTML = `
            <div class="text-center py-12 text-gray-400">
                <i class="bi bi-check-circle text-5xl mb-3 block"></i>
                <p class="text-sm">Sin pedidos listos</p>
            </div>
        `;
    } else {
        colListos.innerHTML = pedidosData.listos.map(pedido => crearTarjetaPedido(pedido, 'listo')).join('');
    }
    
    actualizarContadores();
}

function actualizarContadores() {
    const totalPendientes = pedidosData.pendientes.length;
    const totalPreparacion = pedidosData.preparacion.length;
    const totalListos = pedidosData.listos.length;
    
    document.getElementById('stat-nuevos').textContent = totalPendientes;
    document.getElementById('stat-preparacion').textContent = totalPreparacion;
    document.getElementById('stat-listos').textContent = totalListos;
    
    document.getElementById('count-pendientes').textContent = totalPendientes;
    document.getElementById('count-preparacion').textContent = totalPreparacion;
    document.getElementById('count-listos').textContent = totalListos;
    
    document.getElementById('pedidos-pendientes-count').textContent = totalPendientes;
}

function crearTarjetaPedido(pedido, estado) {
    const colorClass = estado === 'pendiente' ? 'border-red-500' : 
                      estado === 'preparacion' ? 'border-orange-500' : 'border-green-500';
    
    const iconoEstado = estado === 'pendiente' ? 'bi-bell-fill' : 
                       estado === 'preparacion' ? 'bi-fire' : 'bi-check-circle-fill';
    
    const tiempoTranscurrido = pedido.tiempo_espera || 0;
    const tiempoColor = tiempoTranscurrido > 15 ? 'text-red-600 font-bold' : 
                       tiempoTranscurrido > 10 ? 'text-orange-600' : 'text-gray-600';
    
    // Obtener IDs de items para el bot√≥n de acci√≥n
    const itemIds = pedido.items.map(item => item.producto_id || item.id);
    const itemIdsJson = JSON.stringify(itemIds);
    
    return `
        <div class="border-l-4 ${colorClass} bg-white p-4 rounded-lg shadow-sm hover:shadow-md transition">
            <div class="flex items-start justify-between mb-3">
                <div class="flex items-center gap-2">
                    <div class="w-8 h-8 bg-gray-100 rounded-full flex items-center justify-center">
                        <i class="bi ${iconoEstado} text-sm"></i>
                    </div>
                    <div>
                        <p class="font-bold text-gray-800">Mesa ${pedido.mesa}</p>
                        <p class="text-xs text-gray-500">${pedido.folio || ''}</p>
                        ${pedido.mesero ? `<p class="text-xs text-gray-500">Mesero: ${pedido.mesero}</p>` : ''}
                    </div>
                </div>
                <span class="px-2 py-1 bg-gray-100 ${tiempoColor} rounded text-xs font-semibold">
                    ${tiempoTranscurrido} min
                </span>
            </div>
            
            <div class="space-y-2 mb-3">
                ${pedido.items.map(item => `
                    <div class="flex items-center justify-between text-sm">
                        <span class="text-gray-700">
                            <span class="font-bold text-orange-600">${item.cantidad}x</span>
                            ${item.nombre}
                        </span>
                    </div>
                    ${item.notas ? `<p class="text-xs text-gray-500 italic ml-4">üìù ${item.notas}</p>` : ''}
                `).join('')}
            </div>
            
            ${estado === 'pendiente' ? `
                <button onclick='iniciarPreparacion("${pedido.id}", ${itemIdsJson})' class="w-full py-2 bg-orange-500 text-white rounded-lg hover:bg-orange-600 transition font-semibold text-sm">
                    <i class="bi bi-play-fill"></i> Iniciar Preparaci√≥n
                </button>
            ` : ''}
            
            ${estado === 'preparacion' ? `
                <button onclick='marcarListo("${pedido.id}", ${itemIdsJson})' class="w-full py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition font-semibold text-sm">
                    <i class="bi bi-check-circle"></i> Marcar Listo
                </button>
            ` : ''}
            
            ${estado === 'listo' ? `
                <div class="space-y-2">
                    <div class="w-full py-2 bg-green-100 text-green-700 rounded-lg text-center font-semibold text-sm">
                        <i class="bi bi-check-circle-fill"></i> Listo para servir
                    </div>
                    <button onclick='entregarPedido("${pedido.id}", ${itemIdsJson})' class="w-full py-1 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition font-semibold text-xs">
                        <i class="bi bi-send"></i> Marcar Entregado
                    </button>
                </div>
            ` : ''}
        </div>
    `;
}

// ===================================
// CAMBIO DE ESTADO DE PEDIDOS
// ===================================
async function iniciarPreparacion(comandaId, itemIds) {
    try {
        const response = await fetch('/api/cocina/pedido/iniciar', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                comanda_id: comandaId,
                item_ids: itemIds
            })
        });
        
        const data = await response.json();
        
        if (data.success) {
            showToast('‚úÖ Pedido en preparaci√≥n', 'success');
            
            // Recargar pedidos
            setTimeout(() => {
                cargarTodosPedidos();
            }, 500);
        } else {
            showToast('‚ùå Error al iniciar preparaci√≥n', 'error');
        }
    } catch (error) {
        console.error('‚ùå Error:', error);
        showToast('‚ùå Error al iniciar preparaci√≥n', 'error');
    }
}

async function marcarListo(comandaId, itemIds) {
    try {
        const response = await fetch('/api/cocina/pedido/listo', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                comanda_id: comandaId,
                item_ids: itemIds
            })
        });
        
        const data = await response.json();
        
        if (data.success) {
            showToast('‚úÖ ¬°Pedido listo!', 'success');
            
            // Recargar pedidos
            setTimeout(() => {
                cargarTodosPedidos();
                cargarEstadisticas();
            }, 500);
        } else {
            showToast('‚ùå Error al marcar como listo', 'error');
        }
    } catch (error) {
        console.error('‚ùå Error:', error);
        showToast('‚ùå Error al marcar como listo', 'error');
    }
}

async function entregarPedido(comandaId, itemIds) {
    try {
        const response = await fetch('/api/cocina/pedido/entregado', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                comanda_id: comandaId,
                item_ids: itemIds
            })
        });
        
        const data = await response.json();
        
        if (data.success) {
            showToast('‚úÖ Pedido entregado', 'success');
            
            // Recargar pedidos y estad√≠sticas
            setTimeout(() => {
                cargarTodosPedidos();
                cargarEstadisticas();
            }, 500);
        } else {
            showToast('‚ùå Error al marcar como entregado', 'error');
        }
    } catch (error) {
        console.error('‚ùå Error:', error);
        showToast('‚ùå Error al marcar como entregado', 'error');
    }
}

// ===================================
// ACCIONES R√ÅPIDAS
// ===================================
async function marcarNoDisponible() {
    const { value: platillo } = await Swal.fire({
        title: 'Marcar como no disponible',
        input: 'text',
        inputLabel: '¬øQu√© platillo no est√° disponible?',
        inputPlaceholder: 'Nombre del platillo',
        showCancelButton: true,
        confirmButtonText: 'Marcar',
        cancelButtonText: 'Cancelar'
    });
    
    if (platillo) {
        // Aqu√≠ conectar√≠as con tu API de inventario
        showSuccess(`"${platillo}" marcado como no disponible`);
    }
}

function verInventario() {
    window.location.href = "{{ url_for('routes.cocina_inventario') }}";
}

function actualizarPedidos() {
    showLoading('Actualizando pedidos...');
    cargarTodosPedidos();
    cargarEstadisticas();
    
    setTimeout(() => {
        hideLoading();
        showToast('‚úÖ Pedidos actualizados', 'success');
    }, 1000);
}

// ===================================
// FUNCIONES DE NOTIFICACI√ìN
// ===================================
function showToast(message, type = 'info') {
    const Toast = Swal.mixin({
        toast: true,
        position: 'top-end',
        showConfirmButton: false,
        timer: 3000,
        timerProgressBar: true
    });
    
    Toast.fire({
        icon: type,
        title: message
    });
}

function showSuccess(message) {
    Swal.fire({
        icon: 'success',
        title: '¬°√âxito!',
        text: message,
        timer: 2000,
        showConfirmButton: false
    });
}

function showLoading(message = 'Cargando...') {
    Swal.fire({
        title: message,
        allowOutsideClick: false,
        didOpen: () => {
            Swal.showLoading();
        }
    });
}

function hideLoading() {
    Swal.close();
}
</script>
{% endblock %}
Me puedes ayudar con los cambios tambi√©n por favor, paso a paso y desde cero